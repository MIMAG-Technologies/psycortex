<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Psycortex Pvt. Ltd. is dedicated to revolutionizing mental health care by providing innovative, accessible, and evidence-based solutions to enhance the well-being of individuals worldwide."
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://www.paynimo.com/paynimocheckout/client/lib/jquery.min.js"></script>
    <script
      src="https://www.paynimo.com/paynimocheckout/client/lib/jquery.min.js"
      type="text/javascript"
    ></script>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <title>Psycortex Pvt. Ltd</title>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=AW-16675194324"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "AW-16675194324");
    </script>
  </head>
  <body>
    <div id="root"></div>

    <script
      type="text/javascript"
      src="https://www.paynimo.com/Paynimocheckout/server/lib/checkout.js"
    ></script>
    <script type="text/javascript">
      $(document).ready(function () {
        const getCredentials = async () => {
          const token = localStorage.getItem("psycortexTOKEN");
          try {
            const response = await fetch(
              `https://api.psycortex.in/getPaymentGatewayCredentails`,
              {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                  // Authorization: `Bearer ${token}`,
                },
              }
            );

            if (!response.ok) {
              throw new Error("Network response was not ok");
            }

            const res = await response.json();
            return res;
          } catch (error) {
            return {};
          }
        };

        const consumerMobileNo = "7249424403";
        const consumerEmailId = "psycortex01@gmail.com";
        const logoUrl =
          "https://psycortex.in/assets/Images/thebraintakeLogo.png";

        const hashData = async (algo, data) => {
          const encoder = new TextEncoder();
          const dataBuffer = encoder.encode(data);

          const hashBuffer = await crypto.subtle.digest(algo, dataBuffer);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          return hashArray
            .map((byte) => byte.toString(16).padStart(2, "0"))
            .join("");
        };

        const complete = async (
          transactionState,
          transactionIdentifier,
          errorMessage
        ) => {
          const token = localStorage.getItem("psycortexTOKEN");
          const transactionToken = localStorage.getItem("transactionToken");

          try {
            const response = await fetch(
              `https://api.psycortex.in/transaction/complete`,
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${token}`,
                },
                body: JSON.stringify({
                  token: transactionToken,
                  transactionState: transactionState,
                  transactionIdentifier: transactionIdentifier,
                  dateTime: new Date().toISOString(),
                  errorMessage: errorMessage,
                }),
              }
            );

            if (!response.ok) {
              throw new Error("Network response was not ok");
            }

            const res = await response.json();
            if (transactionState === "success") {
              alert("Purchase Successful!");
            }
          } catch (error) {
            if (transactionState === "success") {
              alert(
                "Your payment is done, but due to some technical issues, the item is not added to the purchased list. Please contact our support team!"
              );
            }
          }
        };

        const handleResponse = async (res) => {
          if (
            typeof res !== "undefined" &&
            typeof res.paymentMethod !== "undefined" &&
            typeof res.paymentMethod.paymentTransaction !== "undefined" &&
            typeof res.paymentMethod.paymentTransaction.statusCode !==
              "undefined" &&
            res.paymentMethod.paymentTransaction.statusCode == "0300"
          ) {
            await complete(
              "success",
              res.paymentMethod.paymentTransaction.identifier,
              res.paymentMethod.paymentTransaction.errorMessage
            );
            localStorage.setItem("isTransactionDone", "success");
          } else {
            await complete(
              "failure",
              res.paymentMethod.paymentTransaction.identifier,
              res.paymentMethod.paymentTransaction.errorMessage
            );
            localStorage.setItem("isTransactionDone", "failure");
          }
        };

        const getToken = async (credentials) => {
          const algo = "SHA-512"; // sha256, sha512, md5
          const data = `${credentials.merchantCode}|${
            credentials.txnId
          }|${localStorage.getItem("transactionPaymentAmount")}||${
            credentials.consumerId
          }|${consumerMobileNo}|${consumerEmailId}||||||||||${
            credentials.encryptionKey
          }`;
          return await hashData(algo, data);
        };

        const initTransaction = async () => {
          const credentials = await getCredentials();
          if (Object.keys(credentials).length === 0) return;

          $(document)
            .off("click", "#btnSubmit")
            .on("click", "#btnSubmit", async function (e) {
              e.preventDefault();
              localStorage.setItem("isTransactionDone", "pending");
              const token = await getToken(credentials);

              const configJson = {
                tarCall: false,
                features: {
                  enableAbortResponse: true,
                  enableExpressPay: true,
                  enableInstrumentDeRegistration: true,
                  enableMerTxnDetails: true,
                  enableNewWindowFlow: true,
                },
                consumerData: {
                  deviceId: "WEBSH2", // possible values 'WEBSH1', 'WEBSH2', and 'WEBMD5'
                  token: token,
                  responseHandler: handleResponse,
                  paymentMode: "all",
                  merchantLogoUrl: logoUrl, // provided merchant logo will be displayed
                  merchantId: credentials.merchantCode,
                  consumerId: credentials.consumerId,
                  consumerMobileNo: consumerMobileNo,
                  consumerEmailId: consumerEmailId,
                  txnId: credentials.txnId,
                  items: [
                    {
                      itemId: "first",
                      amount: localStorage.getItem("transactionPaymentAmount"),
                      comAmt: "0",
                    },
                  ],
                  customStyle: {
                    PRIMARY_COLOR_CODE: "#3977b7",
                    SECONDARY_COLOR_CODE: "#FFFFFF",
                    BUTTON_COLOR_CODE_1: "#1969bb",
                    BUTTON_COLOR_CODE_2: "#FFFFFF",
                  },
                },
              };

              $.pnCheckout(configJson);
              if (configJson.features.enableNewWindowFlow) {
                pnCheckoutShared.openNewWindow();
              }
            });
        };

        initTransaction();
      });
    </script>

    <script>
      window.addEventListener("load", function () {
        var contactTimer = setInterval(function () {
          if (document.querySelectorAll("#messageBox").length != 0) {
            gtag("event", "conversion", {
              send_to: "AW-16675194324/iYjbCOvw69sZENSLrY8-",
            });
            clearInterval(contactTimer);
          }
        }, 1000);
      });
    </script>
    <script>
      document.addEventListener("click", function (e) {
        if (e.target.closest('[href*="wa.me"]')) {
          gtag("event", "conversion", {
            send_to: "AW-16675194324/NKz4CO7w69sZENSLrY8-",
          });
        }
        if (e.target.closest('[href="/booking"]')) {
          gtag("event", "conversion", {
            send_to: "AW-16675194324/lS7QCPHw69sZENSLrY8-",
          });
        }
      });
    </script>
  </body>
</html>
